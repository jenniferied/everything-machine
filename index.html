<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Everything Machine — Prozesslog (Kepler)</title>
  <link rel="stylesheet" href="style.css">
  <meta name="description" content="Everything Machine — Prozesslog: Forschung zu multimodalen Inputs und dem digitalen Alter Ego ‚Kepler‘.">
</head>
<body>
  <div class="shell">
    <header class="topbar">
      <div class="brand">
        <div class="logo">⟡</div>
        <div>
          <h1>Everything Machine</h1>
          <div class="subtitle">Prozesslog — Kepler · Multimodale KI · Künstlerische Forschung</div>
        </div>
      </div>
      <nav>
        <button class="navbtn" id="btnHome">Home</button>
        <button class="navbtn" id="btnAbout">About</button>
        <button class="navbtn" id="btnExport">Export</button>
        <button class="navbtn" id="btnImport">Import</button>
      </nav>
    </header>
    <main class="grid">
      <section class="intro panel" id="intro">
        <h2>Kurzfassung (exposé)</h2>
        <p id="manifesto">
          Diese künstlerisch-wissenschaftliche Arbeit untersucht, wie multimodale Eingaben und generative Verfahren genutzt werden können, um das digitale Alter Ego „Kepler“ zu erweitern. Ziel ist, handwerkliche Gestaltungspraktiken und forschungsorientierte Prototypen zu verbinden, damit Entwurfsprozesse als fortlaufende, reflexive Praxis dokumentiert und transformativ untersucht werden können.
        </p>
        <div class="meta small">Ton: akademisch-reflektiv · Sichtbarkeit: Logbuch auf Startseite</div>
      </section>
      <section class="log panel">
        <div class="loghead">
          <h3>Logbuch — Einträge</h3>
          <div class="controls">
            <input id="search" placeholder="Suche Titel, Inhalt oder Tags…">
            <button class="btn" id="newToggle">Neuer Eintrag</button>
          </div>
        </div>
        <div id="editor" class="editor hidden">
          <input id="title" placeholder="Kurztitel (z. B. Phase 1 — Datensammlung)">
          <input id="tags" placeholder="Tags (kommagetrennt) — z. B. Phase1,CharacterSheets">
          <div class="row">
            <textarea id="md" placeholder="Markdown: # Überschrift, **fett**, `code`, ![alt](file)."></textarea>
            <div class="preview">
              <div class="small">Vorschau (HTML)</div>
              <div id="previewInner" class="previewInner"></div>
            </div>
          </div>
          <div class="row small">
            <input id="file" type="file" accept="image/*">
            <div style="flex:1"></div>
            <button class="btn primary" id="save">Speichern</button>
            <button class="btn" id="cancel">Abbrechen</button>
          </div>
        </div>
        <div id="feed" class="feed"></div>
      </section>
    </main>
    <aside class="panel aside">
      <h4>Kurzhandlungen</h4>
      <div class="small">
        <button class="btn" id="clearAll">Alles löschen</button>
        <button class="btn" id="downloadPage">Seite herunterladen</button>
      </div>
      <hr>
      <h4>Tag-Wolke</h4>
      <div id="tagCloud" class="tags"></div>
      <hr>
      <h4>Medien</h4>
      <div id="media" class="media"></div>
    </aside>
    <footer class="foot small">
      Lokale Speicherung (localStorage). Export/Import als JSON für Backup oder Migration. Für GitHub Pages: README befolgen.
    </footer>
  </div>
  <script src="scripts/markdown.js"></script>
  <script>
    // (Der gesamte vorherige JavaScript-Code bleibt hier, unverändert)
    const LS = 'everything_machine_v2';
    let state = {entries:[]};
    function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7)}
    function load(){ try{ state = JSON.parse(localStorage.getItem(LS)) || {entries:[]} }catch(e){ state={entries:[]} } render() }
    function save(){ localStorage.setItem(LS, JSON.stringify(state)) }
    const qs = s => document.querySelector(s);
    function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function markdownToHtml(md){ return window.simpleMarkdownToHtml(md || '') }
    function fileToDataURL(file){ return new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(file) })}
    function clearEditor(){ qs('#title').value=''; qs('#tags').value=''; qs('#md').value=''; qs('#previewInner').innerHTML=''; qs('#file').value=null; }
    function render(){
      const feed = qs('#feed'); feed.innerHTML='';
      const q = qs('#search').value.trim().toLowerCase();
      const tagSet = new Set();
      const mediaDiv = qs('#media'); mediaDiv.innerHTML='';
      state.entries
        .filter(e=> { if(!q) return true; return (e.title||'').toLowerCase().includes(q) || (e.md||'').toLowerCase().includes(q) || (e.tags||'').toLowerCase().includes(q) })
        .sort((a,b)=>b.date.localeCompare(a.date))
        .forEach(e=>{
          (e.tags||'').split(',').map(t=>t.trim()).filter(Boolean).forEach(t=>tagSet.add(t));
          const el = document.createElement('article'); el.className='entry';
          el.innerHTML = `<header><strong>${escapeHtml(e.title||'Ohne Titel')}</strong><span class="meta">${e.date||''}</span></header>
            <div class="entryTags">${(e.tags||'').split(',').filter(Boolean).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join(' ')}</div>
            <section class="entryBody">${markdownToHtml(e.md||'')}</section>
            <footer class="entryActions">
              <button class="btn" data-edit="${e.id}">Bearbeiten</button>
              <button class="btn" data-del="${e.id}">Löschen</button>
              <button class="btn" data-copy="${e.id}">Kopieren</button>
            </footer>`;
          feed.appendChild(el);
          if(e.media){ const img = document.createElement('img'); img.src=e.media; img.alt='media'; img.className='thumb'; mediaDiv.appendChild(img); }
        });
      const cloud = qs('#tagCloud'); cloud.innerHTML='';
      Array.from(tagSet).sort().forEach(t=>{ const s = document.createElement('button'); s.className='tagBtn'; s.textContent=t; s.onclick=()=>{ qs('#search').value=t; render() }; cloud.appendChild(s) })
      save();
    }
    document.getElementById('newToggle').onclick = ()=>{ qs('#editor').classList.toggle('hidden') };
    document.getElementById('cancel').onclick = ()=>{ qs('#editor').classList.add('hidden'); clearEditor() };
    document.getElementById('md').addEventListener('input', ()=>{ qs('#previewInner').innerHTML = markdownToHtml(qs('#md').value) });
    document.getElementById('save').onclick = async ()=>{
      const title = qs('#title').value.trim();
      const tags = qs('#tags').value.trim();
      const md = qs('#md').value;
      const date = new Date().toISOString().slice(0,10);
      const file = qs('#file').files[0];
      let media = null;
      if(file){ media = await fileToDataURL(file) }
      const entry = { id: uid(), title, tags, md, date, media };
      state.entries.push(entry); clearEditor(); qs('#editor').classList.add('hidden'); render();
    };
    document.getElementById('feed').addEventListener('click', (ev)=>{
      const id = ev.target.dataset.edit || ev.target.dataset.del || ev.target.dataset.copy;
      if(!id) return;
      if(ev.target.dataset.edit){
        const e = state.entries.find(x=>x.id===id); if(!e) return;
        qs('#title').value = e.title; qs('#tags').value = e.tags; qs('#md').value = e.md; qs('#previewInner').innerHTML = markdownToHtml(e.md); qs('#editor').classList.remove('hidden');
        state.entries = state.entries.filter(x=>x.id!==id); render();
      } else if(ev.target.dataset.del){
        if(confirm('Eintrag löschen?')){ state.entries=state.entries.filter(x=>x.id!==id); render(); }
      } else if(ev.target.dataset.copy){
        const e = state.entries.find(x=>x.id===id); if(!e) return;
        navigator.clipboard?.writeText((e.title||'') + '\n\n' + e.md).then(()=>alert('Kopiert'));
      }
    });
    document.getElementById('btnExport').onclick = ()=>{
      const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
      const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='everything-machine-export.json'; a.click();
    };
    document.getElementById('btnImport').onclick = ()=>{
      const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
      inp.onchange = e => {
        const f = e.target.files[0];
        const reader = new FileReader();
        reader.onload = ev => {
          try { state = JSON.parse(ev.target.result); save(); render(); alert('Import erfolgreich') }
          catch(err){ alert('Ungültige Datei') }
        };
        reader.readAsText(f);
      };
      inp.click();
    };
    document.getElementById('clearAll').onclick = ()=> {
      if(confirm('Alle Einträge löschen?')){ state.entries=[]; render(); }
    };
    document.getElementById('downloadPage').onclick = ()=>{
      const html = '<!doctype html>\n' + document.documentElement.outerHTML;
      const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([html],{type:'text/html'})); a.download='everything-machine-page.html'; a.click();
    };
    document.getElementById('search').addEventListener('input', render);
    function init(){ load(); render(); }
    init();
  </script>
</body>
</html>
