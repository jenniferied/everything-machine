% Dark Theme LaTeX Template for Everything Machine
% Artistic Research Submission Documents
% Configured for LuaLaTeX with dark background matching website aesthetic

\documentclass[
  9pt,
  a4paper,
  oneside
]{article}

% === ENCODING AND FONT SUPPORT ===
\usepackage{fontspec}

% Open Sans font (body text - clean, readable on dark backgrounds)
\setmainfont{Open Sans}[
  UprightFont = *-Regular,
  BoldFont = *-Bold,
  ItalicFont = *-Italic,
  BoldItalicFont = *-BoldItalic
]
\setsansfont{Open Sans}
\setmonofont{Courier New}

% === PIXEL FONTS ===
% Pixelify Sans - beautiful pixel font for all pixel text
\newfontfamily\pixelfont{Pixelify Sans}
\newfontfamily\pixelitalic{Pixelify Sans}[FakeSlant=0.2]

% Aliases for different uses
\let\pixeltitle\pixelfont
\let\pixelheading\pixelfont
\let\pixelsubtitle\pixelitalic

% === LANGUAGE SUPPORT ===
\usepackage{polyglossia}
\setdefaultlanguage{german}
\setotherlanguage{english}

% === DARK THEME COLORS ===
\usepackage{xcolor}
\usepackage{pagecolor}

% Color definitions matching style.css
\definecolor{darkbg}{HTML}{111111}      % background-color: #111
\definecolor{lighttext}{HTML}{d1d5db}   % color: #d1d5db (text-gray-300)
\definecolor{accentgreen}{HTML}{1a6b40} % dark green for light bg readability
\definecolor{titlegreen}{HTML}{3cb371}  % brighter green for title on dark bg
\definecolor{mutedtext}{HTML}{9ca3af}   % color: #9ca3af (text-gray-400)
\definecolor{darkborder}{HTML}{1f2937}  % background: #1f2937 (bg-gray-800)
\definecolor{contentbg}{HTML}{e0e0e0}  % light gray for content pages
\definecolor{darktext}{HTML}{111111}    % near-black for body text on light bg
\definecolor{claudeorange}{HTML}{D77655}

% === GLOW EFFECT FOR TITLE ===
\usepackage{shadowtext}
\shadowoffset{1pt}
\shadowcolor{accentgreen!40!black}

% Apply dark background and light text globally
\pagecolor{darkbg}
\color{lighttext}

% === BIBLIOGRAPHY ===
% Citations handled by Pandoc --citeproc + CSL file (no biblatex)

% === PAGE LAYOUT ===
% APA 7 standard: 1 inch (2.54cm) margins
\usepackage[
  left=2.54cm,
  right=2.54cm,
  top=2.54cm,
  bottom=2.54cm
]{geometry}

% === PARAGRAPH FORMATTING ===
% No paragraph indent
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5em}    % Small gap between paragraphs

% === LINE SPACING ===
% 1.5 spacing is more readable on dark backgrounds than double
\usepackage{setspace}
\onehalfspacing

% === HEADERS AND FOOTERS ===
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\color{mutedtext!60!darktext}\thepage}

% === SECTION FORMATTING ===
\usepackage{titlesec}
\setcounter{secnumdepth}{0}  % No numbering for headings
\setcounter{tocdepth}{3}

% Level 1: Left-aligned, Pixel Font, Accent Color (compact)
\titleformat{\section}
  {\pixelheading\fontsize{14}{18}\selectfont\raggedright\color{accentgreen}}
  {\thesection}{0.5em}{}

% Level 2: Left-aligned, Pixel Font, Accent Color (compact)
\titleformat{\subsection}
  {\pixelheading\fontsize{12}{16}\selectfont\raggedright\color{accentgreen}}
  {\thesubsection}{0.5em}{}

% Level 3: Left-aligned, Pixel Font, Light Text (compact)
\titleformat{\subsubsection}
  {\pixelheading\fontsize{11}{14}\selectfont\raggedright\color{darktext}}
  {\thesubsubsection}{0.5em}{}

% Spacing around headings (compact)
\titlespacing*{\section}{0pt}{1.2em}{0.5em}
\titlespacing*{\subsection}{0pt}{0.8em}{0.3em}
\titlespacing*{\subsubsection}{0pt}{0.6em}{0.2em}

% === HYPERLINKS ===
\usepackage[
  colorlinks=true,
  linkcolor=accentgreen,
  citecolor=accentgreen,
  urlcolor=accentgreen,
  pdfusetitle
]{hyperref}

% === CHAT BUBBLES (Anhang) ===
\usepackage{tcolorbox}

\newtcolorbox{claudemsg}{
  colback=claudeorange!6!white, colframe=claudeorange!40,
  arc=3mm, boxrule=0.5pt,
  left=3mm, right=3mm, top=2mm, bottom=2mm,
  fontupper=\normalsize, before skip=2mm, after skip=2mm,
  before upper={\raisebox{-1.5pt}{\includegraphics[height=10pt]{claude-icon.png}}\hspace{3pt}\textbf{\color{claudeorange}Claude}\hspace{0.5em}}
}

\newtcolorbox{usermsg}{
  colback=accentgreen!5!white, colframe=accentgreen!25,
  arc=3mm, boxrule=0.5pt,
  left=3mm, right=3mm, top=2mm, bottom=2mm,
  fontupper=\normalsize, before skip=2mm, after skip=2mm,
  before upper={\raisebox{-1.5pt}{\includegraphics[height=10pt]{user-icon.png}}\hspace{3pt}\textbf{\color{accentgreen}Jennifer}\hspace{0.5em}}
}

\newcommand{\chatsection}[1]{%
  \vspace{0.5em}{\pixelheading\fontsize{10}{12}\selectfont\color{accentgreen}#1}\vspace{0.3em}}

% === GRAPHICS ===
\usepackage{graphicx}
\usepackage{float}
\floatplacement{figure}{H}  % keep figures exactly where placed in text

% === TIKZ FOR GRADIENT TEXT ===
\usepackage{tikz}

% Gradient text - uses fading effect from green to lighter
\tikzset{
  fading text/.style={
    text=transparent!0,
  },
}

\makeatletter
\newcommand{\gradienttext}[1]{%
  \begin{tikzpicture}[baseline=(text.base)]
    % First render the text to get dimensions
    \node[inner sep=0pt, opacity=0] (text) {#1};
    % Create gradient background clipped to text
    \begin{scope}
      \clip[use as bounding box] (text.south west) rectangle (text.north east);
      \node[inner sep=0pt, text=accentgreen!60!lighttext] at (text.center) {#1};
    \end{scope}
    % Overlay with left-faded version
    \begin{scope}
      \clip (text.south west) rectangle ([xshift=-0.5\wd\tikz@last@fig@name]text.north east);
      \node[inner sep=0pt, text=accentgreen] at (text.center) {#1};
    \end{scope}
  \end{tikzpicture}%
}
\makeatother

% Graphics path for assets (optimized experiment images first, then fallback)
\graphicspath{{_img_cache/}{assets/}{../../}}

% === EVALUATION COLORS (farbcodierte Tabellen) ===
\usepackage{colortbl}
\definecolor{evalgreen}{HTML}{2E7D32}   % positiv (ja, gut, stark)
\definecolor{evalred}{HTML}{C62828}     % negativ (nein, schwach)
% neutral = standard darktext

% === TABLES ===
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{array}
\usepackage{tabularx}
\usepackage{calc}

% Fix Pandoc longtable caption issue - define dummy counter 'none'
\newcounter{none}

% Table styling for dark theme
\setlength{\heavyrulewidth}{0.08em}
\setlength{\lightrulewidth}{0.05em}
\setlength{\aboverulesep}{0pt}
\setlength{\belowrulesep}{0pt}
\setlength{\arrayrulewidth}{0.05em}
\setlength{\tabcolsep}{6pt}

% Table rules - subtle on light bg
\arrayrulecolor{darktext!30}

% Force darktext in all tables (prevents color-stack issues across pages)
\AtBeginEnvironment{tabular}{\color{darktext}}
\AtBeginEnvironment{tabularx}{\color{darktext}}
\AtBeginEnvironment{longtable}{\color{darktext}}

% === LISTS ===
\usepackage{enumitem}

% Style lists with accent color bullets
\setlist[itemize]{
  label={\color{accentgreen}\textbullet},
  leftmargin=1.5em,
  itemsep=0.25em
}
\setlist[enumerate]{
  label={\color{accentgreen}\arabic*.},
  leftmargin=1.5em,
  itemsep=0.25em
}

% Pandoc tightlist command
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% === PANDOC CSL REFERENCES ===
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{0em}
\newenvironment{CSLReferences}[2]
 {\begin{list}{}{%
  \setlength{\itemindent}{0pt}
  \setlength{\leftmargin}{0pt}
  \setlength{\parsep}{0pt}
  \ifodd #1
   \setlength{\leftmargin}{\cslhangindent}
   \setlength{\itemindent}{-1\cslhangindent}
  \fi
  \setlength{\itemsep}{#2\baselineskip}}}
 {\end{list}}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{}
\newcommand{\CSLRightInline}[1]{#1\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
\newcommand{\citeproctext}{}
\newcommand{\citeproc}[2]{#2}

% === CAPTIONS ===
\usepackage{caption}
\captionsetup{
  font={small,color=darktext},
  labelfont={bf,color=accentgreen},
  format=plain,
  justification=raggedright,
  singlelinecheck=false
}

% === BLOCK QUOTES ===
\renewenvironment{quote}{%
  \list{}{%
    \leftmargin=1.5em
    \rightmargin=1.5em
    \topsep=0.5em
    \parsep=0pt
    \itshape
    \color{darktext!70}
  }%
  \item\relax
}{\endlist}

% === SAMPLE CONTENT STYLING ===
% Use \beispiel{text} to mark Claude-generated sample content
% Renders in gray italic with visual markers
\newcommand{\beispiel}[1]{%
  {\color{mutedtext}\itshape\guillemotleft #1\guillemotright}%
}

% Environment for longer sample content blocks
\newenvironment{beispielblock}{%
  \begin{quote}
  \color{mutedtext}\itshape
  \noindent\guillemotleft\space
}{%
  \space\guillemotright
  \end{quote}
}

% === PANDOC VARIABLES ===
$if(title)$
\title{$title$}
$endif$

$if(author)$
\author{$for(author)$$author$$sep$ \and $endfor$}
$endif$

$if(date)$
\date{$date$}
$else$
\date{}
$endif$

% PDF metadata
\hypersetup{
  pdftitle={$title$},
  pdfauthor={$for(author)$$author$$sep$; $endfor$}
}

% === CUSTOM TITLE PAGE ===
\makeatletter
\renewcommand{\maketitle}{%
  \begin{titlepage}
    \onehalfspacing

    % === HEADER: Logos (TH OWL left, MP right) ===
    \noindent
    \begin{minipage}[t]{0.3\textwidth}
      \raggedright
      \includegraphics[height=1.8cm]{th-owl-logo.png}
    \end{minipage}%
    \hfill
    \begin{minipage}[t]{0.3\textwidth}
      \raggedleft
      \includegraphics[height=1.8cm]{mp-logo.png}
    \end{minipage}

    \vspace{1cm}

    % === KEPLER POINT CLOUD (background visual) ===
    \begin{tikzpicture}[remember picture, overlay]
      \node[opacity=0.4] at (current page.center) {%
        \includegraphics[height=0.75\paperheight]{kepler-cover.png}%
      };
    \end{tikzpicture}

    \vspace{4cm}

    % === TITLE (pixel font with glow effect) ===
    \centering
    \parbox{0.9\textwidth}{\centering\pixeltitle\fontsize{24}{32}\selectfont\color{titlegreen}\shadowtext{\@title}}

    $if(subtitle)$
    \vspace{0.5cm}
    {\pixelsubtitle\fontsize{16}{20}\selectfont\color{titlegreen} $subtitle$ \par}
    $endif$

    \vspace{1.5cm}

    % Author
    {\large\color{lighttext} \@author \par}

    \vspace{0.75cm}

    % Institution
    $if(institute)$
    {\small\color{mutedtext} $institute$ \par}
    $endif$
    $if(department)$
    {\small\color{mutedtext} $department$ \par}
    $endif$

    \vspace{0.75cm}

    % Course info
    $if(course)$
    {\small\color{mutedtext} $course$ \par}
    $endif$
    $if(instructor)$
    {\small\color{mutedtext} $instructor$ \par}
    $endif$

    \vspace{0.75cm}

    % Date
    {\small\color{mutedtext} \@date \par}

    \vfill

    % Decorative line removed for cleaner look

  \end{titlepage}
  \setcounter{page}{2}
}
\makeatother

% === BEGIN DOCUMENT ===
\begin{document}

$if(title)$
\maketitle
\clearpage
$endif$

% Switch to light theme for content pages
\pagecolor{contentbg}
\color{darktext}

$if(abstract)$
\begingroup
\section*{Abstract}
\noindent $abstract$
\endgroup
$endif$

\clearpage

$if(toc)$
{\color{darktext}\tableofcontents}
\clearpage
$endif$

% Main content
$body$

% Bibliography (generated by Pandoc citeproc)
$if(refs)$
\clearpage
{\color{accentgreen}\section*{Literaturverzeichnis}}
\addcontentsline{toc}{section}{Literaturverzeichnis}
{\footnotesize
$refs$
}
$endif$

\end{document}
